var activeBPFId = ""; 
var globalContext;



function formOnLoad(executionContext) {
    var formContext = executionContext.getFormContext();

    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    
    activeBPFId = Xrm.Page.data.process.getActiveProcess().getId();

    setTabFocus(executionContext);
    addOnChange(executionContext);
    pinBPF(executionContext);
    setRequestSubType(executionContext);
    transactionFields(executionContext);
    drawdownRequestTypes(executionContext);
    hideTabs(executionContext);
    hideAllTabsBPF(executionContext);
    HideAdjustmentFieldsForLenderSettlement(executionContext);
    activeStage(executionContext);
    alwaysLocked(executionContext);
    setDisclaimerText(executionContext);
    addCustomFilter(executionContext);
    addCustomFilterForAdjustment(executionContext);
    lockBpfFields(executionContext);
    dataCleanseWarning(executionContext);
    financeOpsCheck(executionContext);
    lockSubmittoFocalPoint(executionContext);
    
    //formContext.getControl("ukn_facility").addPreSearch(listProgrammeFacilityBasedOnBU);

// var investmentProgram = executionContext.getFormContext().getAttribute("ukn_programme").getValue()[0].id;
//if( investmentProgram == "{5A2A4812-11B8-E811-A970-00224800C719}")
//{
//  executionContext.getFormContext().getControl("ukn_drawdownrequesttype").setVisible(false);
//}

}

/* function listProgrammeFacilityBasedOnBU(executionContext) {
    var programmeFilter = null;
    var formContext = executionContext.getFormContext();
    var programmeListIds = getUserBusinessUnitAndProgramme();
    if(programmeListIds.length === 1)
    {
    programmeFilter = "<filter type='and'><condition attribute='ukn_investmentprogramme' operator='eq' value='"+programmeListIds[0]+"'/></filter>";
    }
    else if(programmeListIds.length > 1)
    {
        var buWithMultipleProgrammeList = [];
        programmeListIds.forEach(programme=>buWithMultipleProgrammeList.push("<value>"+programme+"</value>"));
        programmeFilter = "<filter type='and'>"+
        "<condition attribute='ukn_investmentprogramme' operator='in'>"+ 
        buWithMultipleProgrammeList.join('')+
        "</condition></filter>";
    }

    if(programmeFilter !== null)
    formContext.getControl("ukn_facility").addCustomFilter(programmeFilter, "ukn_facility");
}

function getUserBusinessUnitAndProgramme() {
    var programmeList = [];
    var userId = Xrm.Utility.getGlobalContext().userSettings.userId;
    var id = userId.replace(/[{}]/g, '');

    var req = new XMLHttpRequest();
    req.open("GET", Xrm.Page.context.getClientUrl() + "/api/data/v9.1/systemusers(" + id + ")?$select=_businessunitid_value", false);
    req.setRequestHeader("OData-MaxVersion", "4.0");
    req.setRequestHeader("OData-Version", "4.0");
    req.setRequestHeader("Accept", "application/json");
    req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
    req.setRequestHeader("Prefer", "odata.include-annotations=\"*\"");
    req.onreadystatechange = function () {
        if (this.readyState === 4) {
            req.onreadystatechange = null;
            if (this.status === 200) {
                var result = JSON.parse(this.response);
                var businessUnitId = result["_businessunitid_value"];
                programmeList = getProgrammeBasedOnBU(businessUnitId.toUpperCase());

            } else {
                Xrm.Utility.alertDialog(this.statusText);
            }
        }
    };
    req.send();

    return programmeList;
}

function getProgrammeBasedOnBU(businessUnitId) {
    var programmeList = [];
    switch (businessUnitId) {
        //BBI
        case "EB83900C-E49E-E711-8102-70106FAA1531":
            programmeList.push("a5cf842b-6834-e911-a986-00224800cf35");
            break;
        //GWS
        case "67D99800-E49E-E711-8102-70106FAA1531":
            programmeList.push("a95e0075-4db5-ea11-a812-000d3a86d68d");
            programmeList.push("98bcd0ef-4db5-ea11-a812-000d3a86d68d");
            programmeList.push("9ae4724e-b3ca-e711-8108-70106faa2611");
            programmeList.push("9be4724e-b3ca-e711-8108-70106faa2611");
            programmeList.push("4ee01107-e0b5-e811-8149-70106faa1531");
            programmeList.push("a5b3a3f7-8085-eb11-a812-0022481a7154");
            break;
        //BPC
        case "8CDBB22B-E49E-E711-8102-70106FAA1531":
            programmeList.push("6feead31-6834-e911-a986-00224800cf35");
            break;
        //SULCO
        case "2D87900C-E49E-E711-8102-70106FAA1531":
            programmeList.push("5a2a4812-11b8-e811-a970-00224800c719");
            break;
        default:
            break;
    }

    return programmeList;
} */

//CRMD-488 : Approval Requests with Investment ID – 999 shouldn’t be submitted to Focal Point
function lockSubmittoFocalPoint(executionContext) {
    let formContext = executionContext.getFormContext();
    let facility = formContext.getAttribute("ukn_facility").getValue();
    if (facility !== null) {
        Xrm.WebApi.online.retrieveRecord("ukn_facility", facility[0].id, "?$select=ukn_investmentid").then(
            function success(result) {
                let ukn_investmentid = result["ukn_investmentid"];
                if (ukn_investmentid === "999") {
                    formContext.getControl("header_process_ukn_submittofocalpoint").setDisabled(true);
                    formContext.ui.setFormNotification("This approval request will not get pushed to focal point because investment ID for facility is 999.", "WARNING", "FocalPointInvestmentID_FormNotification");
                }
                else {
                    formContext.getControl("header_process_ukn_submittofocalpoint").setDisabled(false);
                    formContext.ui.clearFormNotification("FocalPointInvestmentID_FormNotification");
                }
            },
            function (error) {
                console.log(error.message);
            }
        );
    }
}

//Registers functions that should run on change of fields
function addOnChange(executionContext) {
    var formContext = executionContext.getFormContext();
    formContext.getAttribute("ukn_approvalstatus").addOnChange(setTabFocus);
    formContext.getAttribute("ukn_approvalstatus").addOnChange(alwaysLocked);
    formContext.getAttribute("ukn_approvalrequesttype").addOnChange(setRequestSubType);
    formContext.getAttribute("ukn_approvalrequesttype").addOnChange(transactionFields);
    formContext.getAttribute("ukn_approvalrequesttype").addOnChange(drawdownRequestTypes);
    formContext.getAttribute("ukn_approvalrequesttype").addOnChange(hideTabs);
    formContext.getAttribute("ukn_approvalrequesttype").addOnChange(HideAdjustmentFieldsForLenderSettlement);
    formContext.getAttribute("ukn_facility").addOnChange(HideAdjustmentFieldsForLenderSettlement);
    formContext.getAttribute("ukn_facility").addOnChange(lockSubmittoFocalPoint);
    formContext.getAttribute("ukn_approvalrequesttype").addOnChange(switchBPF);
    formContext.getAttribute("ukn_iscapitalrecallableadjustment").addOnChange(hideAllTabsBPF);
    formContext.getAttribute("ukn_approvalrequesttype").addOnChange(setDisclaimerText);
    formContext.getAttribute("ukn_operationsdecision").addOnChange(setDisclaimerText);
    formContext.getAttribute("ukn_productteamreviewerdecision").addOnChange(setDisclaimerText);
    formContext.getAttribute("ukn_productteamdecision").addOnChange(setDisclaimerText);
    formContext.getAttribute("ukn_distributionapprovaltype").addOnChange(transactionFields);
    formContext.getAttribute("ukn_distributionapprovaltype").addOnChange(hideTabs);
    formContext.getAttribute("ukn_drawdownapprovaltype").addOnChange(transactionFields);
    formContext.getAttribute("ukn_drawdownapprovaltype").addOnChange(hideTabs);
    formContext.getAttribute("ukn_netvalueofdrawdown").addOnChange(hideTabs);
    formContext.getAttribute("ukn_drawdownrequesttype").addOnChange(drawdownRequestTypes);
    formContext.getAttribute("ukn_grossamountrequested").addOnChange(addCustomFilter);
    formContext.getAttribute("ukn_reviewedbyproductteam").addOnChange(addCustomFilter);
    formContext.getAttribute("ukn_reviewedbyproductteam").addOnChange(addCustomFilterForAdjustment);
    formContext.getAttribute("ukn_programme").addOnChange(addCustomFilterForAdjustment);
    //formContext.getAttribute("ukn_approvalrequiredbyfinance").addOnChange(addCustomFilter);
    formContext.data.process.addOnStageChange(activeStage);
    formContext.data.process.addOnStageChange(setTabFocus);
    formContext.data.process.addOnStageChange(lockBpfFields);
    formContext.data.process.addOnStageChange(refreshSubGrids);
}

// Shows a message if the data has been manually cleansed
function dataCleanseWarning(executionContext) {
    var formContext = executionContext.getFormContext();
    var dataCleanseStatus = formContext.getAttribute("ukn_datamanuallycleansed").getValue();
    if (dataCleanseStatus == 1) {
        formContext.ui.setFormNotification("This record has been data cleansed.  Refer to attachment for accurate breakdown information.", "INFO", "100");
    }
}

//Pins the BPF to the right hand side of the screen
function pinBPF(executionContext) {
    var formContext = executionContext.getFormContext();
    formContext.ui.process.setDisplayState("expanded");
}

//Sets the tab focus depending on the Approval Status
function setTabFocus(executionContext) {
    var formContext = executionContext.getFormContext();
    var approvalStatus = formContext.getAttribute("ukn_approvalstatus");
    if (approvalStatus != null) 
    {
        //start-----------------ITSD-30826 fix, set focus based on stage name.
        bpfStageName = formContext.data.process.getActiveStage().getName();
        //approvalStatusName = approvalStatus.getText();
        if (bpfStageName == "Operations") {
            var tabObj = formContext.ui.tabs.get("operations");
            tabObj.setFocus();
        } else if (bpfStageName == "Product Team Review") {
            var tabObj = formContext.ui.tabs.get("product_team_review");
            tabObj.setFocus();
        } else if (bpfStageName == "Product Team Approval") {
            var tabObj = formContext.ui.tabs.get("product_team_approval");
            tabObj.setFocus();
        } else if (bpfStageName == "Finance Ops Checks") {
            var tabObj = formContext.ui.tabs.get("finance_ops_checks");
            tabObj.setFocus();
        } else if (bpfStageName == "Finance Approval") {
            var tabObj = formContext.ui.tabs.get("finance_approval");
            tabObj.setFocus();
        } else if (bpfStageName == "Finance 2ND Approval") {
            var tabObj = formContext.ui.tabs.get("finance_2nd_approval");
            tabObj.setFocus();
        } else if (bpfStageName == "Finance Payments") {
            var tabObj = formContext.ui.tabs.get("finance_payments");
            tabObj.setFocus();
            //end-----------------ITSD-30826 fix
        } else {
            var tabObj = formContext.ui.tabs.get("transaction_header");
            tabObj.setFocus();
        }
    }
}

function setRequestSubType(executionContext) {

    if(activeBPFId == "f9028bf6-7948-42a5-9943-fd342261a476")
    {
        return;
    }

    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    //declare array
    var array = [];
    //Drawdown
    if (approvalType == 968200000) {
        array = [
            ["ukn_drawdownapprovaltype", true, "required"],
            ["header_process_ukn_drawdownapprovaltype", true],
            ["header_process_ukn_drawdownapprovaltype_7", true],
            ["header_process_ukn_drawdownapprovaltype_8", true],
            ["header_process_ukn_drawdownapprovaltype_9", true],
            ["header_process_ukn_drawdownapprovaltype_10", true],
            ["ukn_distributionapprovaltype", false, "none", null],
            ["header_process_ukn_distributionapprovaltype", false],
            ["header_process_ukn_distributionapprovaltype_5", false],
            ["header_process_ukn_distributionapprovaltype_6", false],
            ["header_process_ukn_distributionapprovaltype_7", false],
            ["header_process_ukn_distributionapprovaltype_8", false],
            ["header_process_ukn_netamounttobepaid_9", true],
            ["header_process_ukn_netamounttobepaid_10", true],
            ["header_process_ukn_netamounttobepaid_11", true],
            ["header_process_ukn_netamounttobepaid_12", true],
            ["header_process_ukn_netamounttobereceived_4", false],
            ["header_process_ukn_netamounttobereceived_5", false],
            ["header_process_ukn_netamounttobereceived_6", false],
            ["header_process_ukn_netamounttobereceived_7", false],
            ["header_process_ukn_paymentvaluedate_9", true],
            ["header_process_ukn_paymentvaluedate_10", true],
            ["header_process_ukn_paymentvaluedate_11", true],
            ["header_process_ukn_paymentvaluedate_12", true]
        ];
    }

    //Distribution
    else if (approvalType == 968200001) {
        array = [
            ["ukn_drawdownapprovaltype", false, "none", null],
            ["header_process_ukn_drawdownapprovaltype", false],
            ["header_process_ukn_drawdownapprovaltype_7", false],
            ["header_process_ukn_drawdownapprovaltype_8", false],
            ["header_process_ukn_drawdownapprovaltype_9", false],
            ["header_process_ukn_drawdownapprovaltype_10", false],
            ["ukn_distributionapprovaltype", true, "required"],
            ["header_process_ukn_distributionapprovaltype", true],
            ["header_process_ukn_distributionapprovaltype_5", true],
            ["header_process_ukn_distributionapprovaltype_6", true],
            ["header_process_ukn_distributionapprovaltype_7", true],
            ["header_process_ukn_distributionapprovaltype_8", true],
            ["header_process_ukn_netamounttobepaid_9", false],
            ["header_process_ukn_netamounttobepaid_10", false],
            ["header_process_ukn_netamounttobepaid_11", false],
            ["header_process_ukn_netamounttobepaid_12", false],
            ["header_process_ukn_netamounttobereceived_4", true],
            ["header_process_ukn_netamounttobereceived_5", true],
            ["header_process_ukn_netamounttobereceived_6", true],
            ["header_process_ukn_netamounttobereceived_7", true],
            ["header_process_ukn_paymentvaluedate_9", false],
            ["header_process_ukn_paymentvaluedate_10", false],
            ["header_process_ukn_paymentvaluedate_11", false],
            ["header_process_ukn_paymentvaluedate_12", false]
        ];
    }
    //Lender Settlement
    else if (approvalType == 968200002) {
        array = [
            ["ukn_drawdownapprovaltype", false, "none", null],
            ["header_process_ukn_drawdownapprovaltype", false],
            ["header_process_ukn_drawdownapprovaltype_7", false],
            ["header_process_ukn_drawdownapprovaltype_8", false],
            ["header_process_ukn_drawdownapprovaltype_9", false],
            ["header_process_ukn_drawdownapprovaltype_10", false],
            ["ukn_distributionapprovaltype", false, "none", null],
            ["header_process_ukn_distributionapprovaltype", false],
            ["header_process_ukn_distributionapprovaltype_5", false],
            ["header_process_ukn_distributionapprovaltype_6", false],
            ["header_process_ukn_distributionapprovaltype_7", false],
            ["header_process_ukn_distributionapprovaltype_8", false],
            ["header_process_ukn_netamounttobepaid_9", true],
            ["header_process_ukn_netamounttobepaid_10", true],
            ["header_process_ukn_netamounttobepaid_11", true],
            ["header_process_ukn_netamounttobepaid_12", true],
            ["header_process_ukn_netamounttobereceived_4", false],
            ["header_process_ukn_netamounttobereceived_5", false],
            ["header_process_ukn_netamounttobereceived_6", false],
            ["header_process_ukn_netamounttobereceived_7", false],
            ["header_process_ukn_paymentvaluedate_9", true],
            ["header_process_ukn_paymentvaluedate_10", true],
            ["header_process_ukn_paymentvaluedate_11", true],
            ["header_process_ukn_paymentvaluedate_12", true]
        ];
    }
    //Not Set
    else if (approvalType == null) {
        array = [
            ["ukn_drawdownapprovaltype", false, "none", null],
            ["header_process_ukn_drawdownapprovaltype", false],
            ["header_process_ukn_drawdownapprovaltype_7", false],
            ["header_process_ukn_drawdownapprovaltype_8", false],
            ["header_process_ukn_drawdownapprovaltype_9", false],
            ["header_process_ukn_drawdownapprovaltype_10", false],
            ["ukn_distributionapprovaltype", false, "none", null],
            ["header_process_ukn_distributionapprovaltype", false],
            ["header_process_ukn_distributionapprovaltype_5", false],
            ["header_process_ukn_distributionapprovaltype_6", false],
            ["header_process_ukn_distributionapprovaltype_7", false],
            ["header_process_ukn_distributionapprovaltype_8", false],
            ["header_process_ukn_netamounttobepaid_9", false],
            ["header_process_ukn_netamounttobepaid_10", false],
            ["header_process_ukn_netamounttobepaid_11", false],
            ["header_process_ukn_netamounttobepaid_12", false],
            ["header_process_ukn_netamounttobereceived_4", false],
            ["header_process_ukn_netamounttobereceived_5", false],
            ["header_process_ukn_netamounttobereceived_6", false],
            ["header_process_ukn_netamounttobereceived_7", false],
            ["header_process_ukn_paymentvaluedate_9", false],
            ["header_process_ukn_paymentvaluedate_10", false],
            ["header_process_ukn_paymentvaluedate_11", false],
            ["header_process_ukn_paymentvaluedate_12", false]
        ];
    }

    //check if the array has been set
    if (array.length != 0 || array != null) {
        //go through each item in the array
        array.forEach(function (item) {
            //check the item is the correct size (Make sure no one adds a field which is not valid))
            if (item.length >= 2 || item.length <= 4) {
                //set the popertiers of the array to the variables
                var objName = item[0];
                var objVisiblty = item[1];
                //check to see if the property is null
                if (formContext.getControl(objName) !== null && formContext.getAttribute(objName) !== null) {
                    //if the lenghtr is more than or equal to 2
                    if (item.length >= 2) {
                        //set the visibility 
                        formContext.getControl(objName).setVisible(objVisiblty);
                    }
                    //if the lenghtr is more than or equal to 3
                    if (item.length >= 3) {
                        //set the required level variable
                        var objRequiredLevel = item[2];
                        //set the required level variable on the form
                        formContext.getAttribute(objName).setRequiredLevel(objRequiredLevel);
                    }
                    //if the lenghtr is more than or equal to 4
                    if (item.length >= 4) {
                        //set the new value in a variable
                        var objSetValue = item[3];
                        //set the new value variable on the form
                        formContext.getAttribute(objName).setValue(objSetValue);
                    }
                }
            }

        });
    }
}

function transactionFields(executionContext) {

    if(activeBPFId == "f9028bf6-7948-42a5-9943-fd342261a476")
    {
        return;
    }

    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var drawdownType = formContext.getAttribute("ukn_drawdownapprovaltype").getValue();
    var distributionType = formContext.getAttribute("ukn_distributionapprovaltype").getValue();
    //Drawdown Only
    if (approvalType == 968200000 && drawdownType == 968200000) {
        formContext.getControl("ukn_remainingcommitment").setVisible(true);
        formContext.getControl("ukn_drawdownrequesttype").setVisible(true);
        formContext.getControl("ukn_grossvalueofdrawdown").setVisible(true);
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("required");
        formContext.getControl("ukn_netvalueofdrawdown").setVisible(true);
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("required")
        formContext.getControl("ukn_grossvalueofdistributableproceeds").setVisible(false);
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("none");
        formContext.getControl("ukn_totalamountofdistributionsnotice").setVisible(false);
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("none");
        formContext.getControl("ukn_totalvalueofclaim").setVisible(false);
        formContext.getAttribute("ukn_totalvalueofclaim").setRequiredLevel("none");
        formContext.getControl("ukn_dateoftransfertobankaccount").setVisible(false);
        formContext.getControl("ukn_paymentvaluedate").setVisible(true);
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("required");
        formContext.getControl("ukn_grossamountrequested").setVisible(true);
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("required");
        formContext.getControl("ukn_equalisationpayable").setVisible(true);
        formContext.getControl("ukn_capitalrepayments").setVisible(false);
        formContext.getControl("ukn_capitalrecallable").setVisible(false);
        formContext.getControl("ukn_equalisationreceivable").setVisible(false);
        formContext.getControl("ukn_interestprioritisedreturns").setVisible(false);
        formContext.getControl("ukn_nonutiliseddrawdowns").setVisible(false);
        formContext.getControl("ukn_commitmentfees").setVisible(false);
        formContext.getControl("ukn_lossclaims").setVisible(false);
        formContext.getControl("ukn_interestfees").setVisible(false);
        formContext.getControl("ukn_otherleviedfees").setVisible(false);
        formContext.getControl("ukn_arrangementfees").setVisible(false);
        formContext.getControl("ukn_nonutilisationfees").setVisible(false);
        formContext.getControl("ukn_directtopl").setVisible(false);
        formContext.getControl("ukn_netamounttobepaid").setVisible(true);
        formContext.getControl("ukn_netamounttobereceived").setVisible(false);
        formContext.getControl("ukn_approvedbyops").setVisible(true);
        formContext.getControl("ukn_dateapprovedops").setVisible(true);
        formContext.getControl("ukn_checkedby").setVisible(false);
        formContext.getControl("ukn_datechecked").setVisible(false);
        formContext.getControl("ukn_reviewedbyproductteam").setVisible(true);
        formContext.getControl("ukn_datetobepaid").setVisible(true);
        formContext.getControl("ukn_requestwithinapproveddelegatedauthority").setVisible(true);
        formContext.getControl("ukn_actionedbyonbankline").setVisible(true);
        formContext.getControl("ukn_bankline1stauthorisername").setVisible(true);
        formContext.getControl("ukn_bankline2ndauthorisername").setVisible(true);
        formContext.getControl("ukn_moneyinthebankaccountreceivedchecked").setVisible(false);
        formContext.getControl("ukn_actualsterlingamountpaid").setVisible(true);
        formContext.getControl("ukn_bankdetailschecked").setVisible(true);
        formContext.getControl("ukn_dateactionedonbankline").setVisible(true);
        formContext.getControl("ukn_firstauthoriserdate").setVisible(true);
        formContext.getControl("ukn_secondauthoriserdate").setVisible(true);
        formContext.getControl("ukn_datereceivedintothebankaccount").setVisible(false);
        
        formContext.getControl("ukn_approvalrequiredbyfinance").setVisible(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setVisible(true);
        
        formContext.getControl("header_process_ukn_funddeliverypartner").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_1").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_2").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_13").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_14").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_15").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_16").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_1").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_2").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_13").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_14").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_15").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_16").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_1").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_2").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_13").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_14").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_15").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_16").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_1").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_2").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_9").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_10").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_11").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_12").setDisabled(true);
        formContext.getControl("header_process_ukn_facility").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_1").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_2").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_13").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_14").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_15").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_16").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype_2").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype_3").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype_7").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype_8").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype_9").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype_10").setDisabled(true);
    }
    //Net Drawdown
    else if (approvalType == 968200000 && drawdownType == 968200001) {
        
        var approvalType = formContext.getAttribute("ukn_netvalueofdrawdown").getValue();

        formContext.getControl("ukn_remainingcommitment").setVisible(true);
        formContext.getControl("ukn_drawdownrequesttype").setVisible(true);
        formContext.getControl("ukn_grossvalueofdrawdown").setVisible(true);
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("required");
        formContext.getControl("ukn_netvalueofdrawdown").setVisible(true);
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("required");
        formContext.getControl("ukn_grossvalueofdistributableproceeds").setVisible(false);
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("none");
        formContext.getControl("ukn_totalamountofdistributionsnotice").setVisible(false);
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("none");
        formContext.getControl("ukn_totalvalueofclaim").setVisible(false);
        formContext.getAttribute("ukn_totalvalueofclaim").setRequiredLevel("none");
        formContext.getControl("ukn_dateoftransfertobankaccount").setVisible(false);
        formContext.getControl("ukn_paymentvaluedate").setVisible(true);
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("required");
        formContext.getControl("ukn_grossamountrequested").setVisible(true);
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("required");
        formContext.getControl("ukn_equalisationpayable").setVisible(true);
        formContext.getControl("ukn_capitalrepayments").setVisible(true);
        formContext.getControl("ukn_capitalrecallable").setVisible(true);
        formContext.getControl("ukn_equalisationreceivable").setVisible(true);
        formContext.getControl("ukn_interestprioritisedreturns").setVisible(true);
        formContext.getControl("ukn_nonutiliseddrawdowns").setVisible(true);
        formContext.getControl("ukn_commitmentfees").setVisible(true);
        formContext.getControl("ukn_lossclaims").setVisible(false);
        formContext.getControl("ukn_interestfees").setVisible(false);
        formContext.getControl("ukn_otherleviedfees").setVisible(false);
        formContext.getControl("ukn_arrangementfees").setVisible(true);
        formContext.getControl("ukn_nonutilisationfees").setVisible(true);
        formContext.getControl("ukn_directtopl").setVisible(true);
        formContext.getControl("ukn_netamounttobepaid").setVisible(true);
        formContext.getControl("ukn_netamounttobereceived").setVisible(false);
        formContext.getControl("ukn_approvedbyops").setVisible(true);
        formContext.getControl("ukn_dateapprovedops").setVisible(true);
        formContext.getControl("ukn_checkedby").setVisible(false);
        formContext.getControl("ukn_datechecked").setVisible(false);
        formContext.getControl("ukn_reviewedbyproductteam").setVisible(true);
        formContext.getControl("ukn_datetobepaid").setVisible(true);
        formContext.getControl("ukn_requestwithinapproveddelegatedauthority").setVisible(true);
        formContext.getControl("ukn_actionedbyonbankline").setVisible(true);
        formContext.getControl("ukn_bankline1stauthorisername").setVisible(true);
        formContext.getControl("ukn_bankline2ndauthorisername").setVisible(true);
        formContext.getControl("ukn_moneyinthebankaccountreceivedchecked").setVisible(false);
        formContext.getControl("ukn_actualsterlingamountpaid").setVisible(true);
        formContext.getControl("ukn_bankdetailschecked").setVisible(true);
        formContext.getControl("ukn_dateactionedonbankline").setVisible(true);
        formContext.getControl("ukn_firstauthoriserdate").setVisible(true);
        formContext.getControl("ukn_secondauthoriserdate").setVisible(true);
        formContext.getControl("ukn_datereceivedintothebankaccount").setVisible(false);
        
        formContext.getControl("ukn_approvalrequiredbyfinance").setVisible(true);
        if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance") !== null) {
            formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setVisible(true);
        }
        
        
        
        
        
        formContext.getControl("header_process_ukn_funddeliverypartner_3").setDisabled(true);
        if (formContext.getControl("header_process_ukn_funddeliverypartner_4") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_4").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_5") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_13") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_14") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_14").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_15") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_15").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_16") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_16").setDisabled(true);
        }
        formContext.getControl("header_process_transactioncurrencyid_3").setDisabled(true);
        if (formContext.getControl("header_process_transactioncurrencyid_4") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_4").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_5") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_13") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_14") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_14").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_15") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_15").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_16") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_3") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_3").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_4") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_4").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_5") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_13") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_14") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_14").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_15") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_15").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_16") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_paymentvaluedate_3") !== null) {
            formContext.getControl("header_process_ukn_paymentvaluedate_3").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_paymentvaluedate_4") !== null) {
            formContext.getControl("header_process_ukn_paymentvaluedate_4").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_paymentvaluedate_5") !== null) {
            formContext.getControl("header_process_ukn_paymentvaluedate_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_paymentvaluedate_9") !== null) {
            formContext.getControl("header_process_ukn_paymentvaluedate_9").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_paymentvaluedate_10") !== null) {
            formContext.getControl("header_process_ukn_paymentvaluedate_10").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_paymentvaluedate_11") !== null) {
            formContext.getControl("header_process_ukn_paymentvaluedate_11").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_paymentvaluedate_12") !== null) {
            formContext.getControl("header_process_ukn_paymentvaluedate_12").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_3") !== null) {
            formContext.getControl("header_process_ukn_facility_3").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_4") !== null) {
            formContext.getControl("header_process_ukn_facility_4").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_5") !== null) {
            formContext.getControl("header_process_ukn_facility_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_13") !== null) {
            formContext.getControl("header_process_ukn_facility_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_14") !== null) {
            formContext.getControl("header_process_ukn_facility_14").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_15") !== null) {
            formContext.getControl("header_process_ukn_facility_15").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_16") !== null) {
            formContext.getControl("header_process_ukn_facility_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype_4") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype_4").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype_5") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype_6") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype_6").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype_7") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype_7").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype_8") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype_8").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype_9") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype_9").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype_10") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype_10").setDisabled(true);
        }
    }
    //Distribution Only
    else if (approvalType == 968200001 && distributionType == 968200000) {
        formContext.getControl("ukn_remainingcommitment").setVisible(true);
        formContext.getControl("ukn_drawdownrequesttype").setVisible(false);
        formContext.getControl("ukn_grossvalueofdrawdown").setVisible(false);
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("none");
        formContext.getControl("ukn_netvalueofdrawdown").setVisible(false);
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("none")
        formContext.getControl("ukn_drawdownnoticedate").setVisible(false);
        formContext.getControl("ukn_grossvalueofdistributableproceeds").setVisible(true);
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("required");
        formContext.getControl("ukn_totalamountofdistributionsnotice").setVisible(true);
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("required");
        formContext.getControl("ukn_totalvalueofclaim").setVisible(false);
        formContext.getAttribute("ukn_totalvalueofclaim").setRequiredLevel("none");
        formContext.getControl("ukn_dateoftransfertobankaccount").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_paymentvaluedate").setVisible(false);
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("none");
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
        formContext.getControl("ukn_grossamountrequested").setVisible(false);
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("none");
        formContext.getControl("ukn_equalisationpayable").setVisible(false);
        formContext.getControl("ukn_capitalrepayments").setVisible(true);
        formContext.getControl("ukn_capitalrecallable").setVisible(true);
        formContext.getControl("ukn_equalisationreceivable").setVisible(true);
        formContext.getControl("ukn_interestprioritisedreturns").setVisible(true);
        formContext.getControl("ukn_nonutiliseddrawdowns").setVisible(true);
        formContext.getControl("ukn_commitmentfees").setVisible(true);
        formContext.getControl("ukn_lossclaims").setVisible(false);
        formContext.getControl("ukn_interestfees").setVisible(false);
        formContext.getControl("ukn_otherleviedfees").setVisible(false);
        formContext.getControl("ukn_arrangementfees").setVisible(true);
        formContext.getControl("ukn_nonutilisationfees").setVisible(true);
        formContext.getControl("ukn_directtopl").setVisible(true);
        formContext.getControl("ukn_netamounttobepaid").setVisible(false);
        formContext.getControl("ukn_netamounttobereceived").setVisible(true);
        formContext.getControl("ukn_approvedbyops").setVisible(false);
        formContext.getControl("ukn_dateapprovedops").setVisible(false);
        formContext.getControl("ukn_checkedby").setVisible(true);
        formContext.getControl("ukn_datechecked").setVisible(true);
        formContext.getControl("ukn_reviewedbyproductteam").setVisible(false);
        formContext.getControl("ukn_datetobepaid").setVisible(false);
        formContext.getControl("ukn_requestwithinapproveddelegatedauthority").setVisible(false);
        formContext.getControl("ukn_actionedbyonbankline").setVisible(false);
        formContext.getControl("ukn_bankline1stauthorisername").setVisible(false);
        formContext.getControl("ukn_bankline2ndauthorisername").setVisible(false);
        formContext.getControl("ukn_moneyinthebankaccountreceivedchecked").setVisible(true);
        formContext.getControl("ukn_actualsterlingamountpaid").setVisible(true);
        formContext.getControl("ukn_bankdetailschecked").setVisible(false);
        formContext.getControl("ukn_dateactionedonbankline").setVisible(false);
        formContext.getControl("ukn_firstauthoriserdate").setVisible(false);
        formContext.getControl("ukn_secondauthoriserdate").setVisible(false);
        formContext.getControl("ukn_datereceivedintothebankaccount").setVisible(true);
        formContext.getControl("ukn_approvalrequiredbyfinance").setVisible(false);
        if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance") !== null) {
            formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setVisible(false);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_6") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_6").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_13") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_16") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_6") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_6").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_13") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_16") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_6") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_6").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_13") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_16") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_6") !== null) {
            formContext.getControl("header_process_ukn_facility_6").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_13") !== null) {
            formContext.getControl("header_process_ukn_facility_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_16") !== null) {
            formContext.getControl("header_process_ukn_facility_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_1") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_1").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_5") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_8") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_8").setDisabled(true);
        }
    }
    //Net Distribution
    else if (approvalType == 968200001 && distributionType == 968200001) {
        formContext.getControl("ukn_remainingcommitment").setVisible(true);
        formContext.getControl("ukn_drawdownrequesttype").setVisible(false);
        formContext.getControl("ukn_grossvalueofdrawdown").setVisible(false);
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("none");
        formContext.getControl("ukn_netvalueofdrawdown").setVisible(false);
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("none")
        formContext.getControl("ukn_drawdownnoticedate").setVisible(false);
        formContext.getControl("ukn_grossvalueofdistributableproceeds").setVisible(true);
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("required");
        formContext.getControl("ukn_totalamountofdistributionsnotice").setVisible(true);
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("required");
        formContext.getControl("ukn_totalvalueofclaim").setVisible(false);
        formContext.getAttribute("ukn_totalvalueofclaim").setRequiredLevel("none");
        formContext.getControl("ukn_dateoftransfertobankaccount").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_paymentvaluedate").setVisible(false);
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("none");
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
        formContext.getControl("ukn_grossamountrequested").setVisible(true);
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("required");
        formContext.getControl("ukn_equalisationpayable").setVisible(true);
        formContext.getControl("ukn_capitalrepayments").setVisible(true);
        formContext.getControl("ukn_capitalrecallable").setVisible(true);
        formContext.getControl("ukn_equalisationreceivable").setVisible(true);
        formContext.getControl("ukn_interestprioritisedreturns").setVisible(true);
        formContext.getControl("ukn_nonutiliseddrawdowns").setVisible(true);
        formContext.getControl("ukn_commitmentfees").setVisible(true);
        formContext.getControl("ukn_lossclaims").setVisible(false);
        formContext.getControl("ukn_interestfees").setVisible(false);
        formContext.getControl("ukn_otherleviedfees").setVisible(false);
        formContext.getControl("ukn_arrangementfees").setVisible(true);
        formContext.getControl("ukn_nonutilisationfees").setVisible(true);
        formContext.getControl("ukn_directtopl").setVisible(true);
        formContext.getControl("ukn_netamounttobepaid").setVisible(false);
        formContext.getControl("ukn_netamounttobereceived").setVisible(true);
        formContext.getControl("ukn_approvedbyops").setVisible(false);
        formContext.getControl("ukn_dateapprovedops").setVisible(false);
        formContext.getControl("ukn_checkedby").setVisible(true);
        formContext.getControl("ukn_datechecked").setVisible(true);
        formContext.getControl("ukn_reviewedbyproductteam").setVisible(true);
        formContext.getControl("ukn_datetobepaid").setVisible(false);
        formContext.getControl("ukn_requestwithinapproveddelegatedauthority").setVisible(false);
        formContext.getControl("ukn_actionedbyonbankline").setVisible(false);
        formContext.getControl("ukn_bankline1stauthorisername").setVisible(false);
        formContext.getControl("ukn_bankline2ndauthorisername").setVisible(false);
        formContext.getControl("ukn_moneyinthebankaccountreceivedchecked").setVisible(true);
        formContext.getControl("ukn_actualsterlingamountpaid").setVisible(true);
        formContext.getControl("ukn_bankdetailschecked").setVisible(false);
        formContext.getControl("ukn_dateactionedonbankline").setVisible(false);
        formContext.getControl("ukn_firstauthoriserdate").setVisible(false);
        formContext.getControl("ukn_secondauthoriserdate").setVisible(false);
        formContext.getControl("ukn_datereceivedintothebankaccount").setVisible(true);
        formContext.getControl("ukn_approvalrequiredbyfinance").setVisible(false);
        if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance") !== null) {
            formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setVisible(false);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_7") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_7").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_8") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_8").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_9") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_9").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_13") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_funddeliverypartner_16") !== null) {
            formContext.getControl("header_process_ukn_funddeliverypartner_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_7") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_7").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_8") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_8").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_9") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_9").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_13") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_transactioncurrencyid_16") !== null) {
            formContext.getControl("header_process_transactioncurrencyid_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_7") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_7").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_8") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_8").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_9") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_9").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_13") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_noticereceiveddate_16") !== null) {
            formContext.getControl("header_process_ukn_noticereceiveddate_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_7") !== null) {
            formContext.getControl("header_process_ukn_facility_7").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_8") !== null) {
            formContext.getControl("header_process_ukn_facility_8").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_9") !== null) {
            formContext.getControl("header_process_ukn_facility_9").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_13") !== null) {
            formContext.getControl("header_process_ukn_facility_13").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_facility_16") !== null) {
            formContext.getControl("header_process_ukn_facility_16").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_2") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_2").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_3") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_3").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_4") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_4").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_5") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_5").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype_8") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype_8").setDisabled(true);
        }
    }
    //Lender Settlements
    else if (approvalType == 968200002) {
        formContext.getControl("ukn_remainingcommitment").setVisible(false);
        formContext.getControl("ukn_drawdownrequesttype").setVisible(false);
        formContext.getControl("ukn_grossvalueofdrawdown").setVisible(false);
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("none");
        formContext.getControl("ukn_netvalueofdrawdown").setVisible(false);
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("none")
        formContext.getControl("ukn_grossvalueofdistributableproceeds").setVisible(false);
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("none");
        formContext.getControl("ukn_totalamountofdistributionsnotice").setVisible(false);
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("none");
        formContext.getControl("ukn_totalvalueofclaim").setVisible(true);
        formContext.getAttribute("ukn_totalvalueofclaim").setRequiredLevel("required");
        formContext.getControl("ukn_dateoftransfertobankaccount").setVisible(false);
        formContext.getControl("ukn_paymentvaluedate").setVisible(true);
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("required");
        formContext.getControl("ukn_grossamountrequested").setVisible(false);
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("none");
        formContext.getControl("ukn_equalisationpayable").setVisible(false);
        formContext.getControl("ukn_capitalrepayments").setVisible(false);
        formContext.getControl("ukn_capitalrecallable").setVisible(false);
        formContext.getControl("ukn_equalisationreceivable").setVisible(false);
        formContext.getControl("ukn_interestprioritisedreturns").setVisible(false);
        formContext.getControl("ukn_nonutiliseddrawdowns").setVisible(false);
        formContext.getControl("ukn_commitmentfees").setVisible(false);
        formContext.getControl("ukn_lossclaims").setVisible(true);
        formContext.getControl("ukn_interestfees").setVisible(true);
        formContext.getControl("ukn_otherleviedfees").setVisible(true);
        formContext.getControl("ukn_arrangementfees").setVisible(true);
        formContext.getControl("ukn_nonutilisationfees").setVisible(false);
        formContext.getControl("ukn_directtopl").setVisible(false);
        formContext.getControl("ukn_netamounttobepaid").setVisible(true);
        formContext.getControl("ukn_netamounttobereceived").setVisible(false);
        formContext.getControl("ukn_approvedbyops").setVisible(true);
        formContext.getControl("ukn_dateapprovedops").setVisible(true);
        formContext.getControl("ukn_checkedby").setVisible(false);
        formContext.getControl("ukn_datechecked").setVisible(false);
        formContext.getControl("ukn_reviewedbyproductteam").setVisible(true);
        formContext.getControl("ukn_datetobepaid").setVisible(true);
        formContext.getControl("ukn_requestwithinapproveddelegatedauthority").setVisible(true);
        formContext.getControl("ukn_actionedbyonbankline").setVisible(true);
        formContext.getControl("ukn_bankline1stauthorisername").setVisible(true);
        formContext.getControl("ukn_bankline2ndauthorisername").setVisible(true);
        formContext.getControl("ukn_moneyinthebankaccountreceivedchecked").setVisible(false);
        formContext.getControl("ukn_actualsterlingamountpaid").setVisible(true);
        formContext.getControl("ukn_bankdetailschecked").setVisible(true);
        formContext.getControl("ukn_dateactionedonbankline").setVisible(true);
        formContext.getControl("ukn_firstauthoriserdate").setVisible(true);
        formContext.getControl("ukn_secondauthoriserdate").setVisible(true);
        formContext.getControl("ukn_datereceivedintothebankaccount").setVisible(false);
        formContext.getControl("ukn_approvalrequiredbyfinance").setVisible(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setVisible(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_10").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_11").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_12").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_13").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_14").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_15").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_16").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_10").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_11").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_12").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_13").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_14").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_15").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_16").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_10").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_11").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_12").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_13").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_14").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_15").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_16").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_6").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_7").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_8").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_9").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_10").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_11").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_12").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_10").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_11").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_12").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_13").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_14").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_15").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_16").setDisabled(true);
    }
    else if(approvalType == 968200003)
    {
        formContext.getControl("approvalcheckquestionandanswers").setVisible(false);
        formContext.getControl("approvalcheckquestionsanswers").setVisible(false);
    } 
    else if (approvalType != 968200003){
        formContext.getControl("header_process_ukn_facility_13").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_14").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_15").setDisabled(true);
        formContext.getControl("header_process_ukn_facility_16").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_13").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_14").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_15").setDisabled(true);
        formContext.getControl("header_process_ukn_funddeliverypartner_16").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_13").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_14").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_15").setDisabled(true);
        formContext.getControl("header_process_transactioncurrencyid_16").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_13").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_14").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_15").setDisabled(true);
        formContext.getControl("header_process_ukn_noticereceiveddate_16").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_9").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_10").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_11").setDisabled(true);
        formContext.getControl("header_process_ukn_paymentvaluedate_12").setDisabled(true);
    }
    
}

function drawdownRequestTypes(executionContext) {

    if(activeBPFId == "f9028bf6-7948-42a5-9943-fd342261a476")
    {
        return;
    }
    
    //Show fields specific to Drawdown Request Type
    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var drawdownRequest = formContext.getAttribute("ukn_drawdownrequesttype").getValue();
    //BBI Drawdown
    if (approvalType == 968200000 && drawdownRequest == 968200000) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
    }
    //GWS EFG Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200001) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
    }
    //GWS Enable Funding Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200002) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(true);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("required")
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
    }
    //GWS H2G Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200003) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
    }
    //NPIL MEIL BBFL Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200004) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(false);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(true);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(true);
        formContext.getControl("ukn_tranchenumber").setVisible(true);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
    }
    //Regional - Cornwall Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200005) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(true);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(true);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(true);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(true);
    }
    //Regional - MEIL Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200006) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(true);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(true);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(true);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(true);
    }
    //Regional - NPIL Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200007) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(true);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(true);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(true);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(true);
    }
    //VCS Drawdown
    else if (approvalType == 968200000 && drawdownRequest == 968200008) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(true);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
    } else if (approvalType == 968200000 && drawdownRequest == null) {
        formContext.getControl("ukn_drawdownnoticedate").setVisible(false);
        formContext.getControl("ukn_dateofdisbursementrequestdodr").setVisible(false);
        formContext.getControl("ukn_requesteddisbursementdaterdd").setVisible(false);
        formContext.getControl("ukn_tranchenumber").setVisible(false);
        formContext.getControl("ukn_uniquereferencenumber").setVisible(false);
        formContext.getControl("ukn_drawdownpurpose").setVisible(false);
        formContext.getAttribute("ukn_drawdownpurpose").setRequiredLevel("none")
        formContext.getControl("ukn_banklineaccountname").setVisible(false);
        formContext.getControl("ukn_valueoffundmanagerfeesandcosts").setVisible(false);
        formContext.getControl("ukn_valueofinvestmentcapitalrequired").setVisible(false);
    }
}

function HideAdjustmentFieldsForLenderSettlement(executionContext)
{
    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var facility = formContext.getAttribute("ukn_facility").getValue();
 
    if (approvalType == 968200002 && facility != null)
    {
            Xrm.WebApi.online.retrieveRecord("ukn_facility", facility[0].id, "?$select=ukn_facilityreference").then(
            function success(result) 
            {                
                let facilityReference = result["ukn_facilityreference"];
                
                if (facilityReference == "FAC-00000423" ||
                    facilityReference == "FAC-00000421" ||
                    facilityReference == "FAC-00000422" ||
                    facilityReference == "FAC-00000749" ||
                    facilityReference == "FAC-00000092") 
                {
                    formContext.getControl("ukn_slfadjustments").setVisible(true);
                    formContext.getControl("ukn_recoveryadjustments").setVisible(true);
                    formContext.getControl("ukn_claimadjustments").setVisible(true);
                }
                else 
                {
                    formContext.getControl("ukn_slfadjustments").setVisible(false);
                    formContext.getControl("ukn_recoveryadjustments").setVisible(false);
                    formContext.getControl("ukn_claimadjustments").setVisible(false);
                }
            },
            function (error) {
                console.log(error.message);
            }
        );                
    }
    else
    {
        formContext.getControl("ukn_slfadjustments").setVisible(false);
        formContext.getControl("ukn_recoveryadjustments").setVisible(false);
        formContext.getControl("ukn_claimadjustments").setVisible(false);
    }
}

function hideTabs(executionContext) {
    //Hide Tabs based on Approval Type & Distribution Type
    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var distributionType = formContext.getAttribute("ukn_distributionapprovaltype").getValue();    
    var reviewTab = formContext.ui.tabs.get("product_team_review");
    var approvalTab = formContext.ui.tabs.get("product_team_approval");
    var financeApprovalTab = formContext.ui.tabs.get("finance_approval");
    var finance2ndApprovalTab = formContext.ui.tabs.get("finance_2nd_approval");
    var financeOpsCheckTab = formContext.ui.tabs.get("finance_ops_checks");
    var financePaymentsTab = formContext.ui.tabs.get("finance_payments");
    var operationsTab = formContext.ui.tabs.get("operations");
    var netValueofDrawdown = formContext.getAttribute("ukn_netvalueofdrawdown").getValue();
    var opsgrid = formContext.getControl("approvalcheckquestionandanswers");
    var ptrgrid = formContext.getControl("approvalcheckquestionsanswers");

    operationsTab.setVisible(true);
    financePaymentsTab.setVisible(true);
    opsgrid.setVisible(true);
    ptrgrid.setVisible(true);
    
    if (distributionType == 968200000) 
    {
        reviewTab.setVisible(false);
        approvalTab.setVisible(false);
    } 
    else 
    {
        reviewTab.setVisible(true);
        approvalTab.setVisible(true);
    }
    //When Approval Request Type is Adjustment then we need to hide Finance options except Finance Payment. CRMD-752
    if (approvalType == 968200001 || approvalType == 968200003) {
        financeApprovalTab.setVisible(false);
        finance2ndApprovalTab.setVisible(false);
    } 
    else 
    {
        if(netValueofDrawdown == 0)
        {
            financeOpsCheckTab.setVisible(false);
            financeApprovalTab.setVisible(false);
            finance2ndApprovalTab.setVisible(false);
            financePaymentsTab.setVisible(false);
        }
        else
        {
            financeOpsCheckTab.setVisible(true);
            financeApprovalTab.setVisible(true);
            finance2ndApprovalTab.setVisible(true);
            financePaymentsTab.setVisible(true);
        }
    }
    //When Approval Request Type is Adjustment then we need to hide Finance options except Finance Payment. CRMD-752
    if (approvalType == 968200003) 
    {
        opsgrid.setVisible(false);
        ptrgrid.setVisible(false);
        financeOpsCheckTab.setVisible(false);
        financePaymentsTab.setVisible(false);
    }        
}
//When Approval Request Type is Adjustment and Does Adjustment requires Approval is True then we need to hide all TABS except Transaction Header, Finance Payment and Focal Point
//CRMD-838
function hideAllTabsBPF(executionContext)
{
    var formContext = executionContext.getFormContext();
    var iscapitalrecallableadjustment = formContext.getAttribute("ukn_iscapitalrecallableadjustment").getValue();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    
    var operationsTab = formContext.ui.tabs.get("operations");
    var reviewTab = formContext.ui.tabs.get("product_team_review");
    var approvalTab = formContext.ui.tabs.get("product_team_approval");
    var financeApprovalTab = formContext.ui.tabs.get("finance_approval");
    var finance2ndApprovalTab = formContext.ui.tabs.get("finance_2nd_approval");
    var financeOpsCheckTab = formContext.ui.tabs.get("finance_ops_checks");
    var financePaymentsTab = formContext.ui.tabs.get("finance_payments");   

    if(approvalType == 968200003 && iscapitalrecallableadjustment == true)
    {
        operationsTab.setVisible(false);
        reviewTab.setVisible(false);
        approvalTab.setVisible(false);
        financeApprovalTab.setVisible(false);
        finance2ndApprovalTab.setVisible(false);
        financeOpsCheckTab.setVisible(false);
        financePaymentsTab.setVisible(false);

        formContext.getAttribute("ukn_grossamountrequested").setValue(0.00);
        formContext.getAttribute("ukn_equalisationpayable").setValue(0.00);
        formContext.getAttribute("ukn_equalisationreceivable").setValue(0.00);
        formContext.getAttribute("ukn_interestprioritisedreturns").setValue(0.00);
        formContext.getAttribute("ukn_nonutiliseddrawdowns").setValue(0.00);
        formContext.getAttribute("ukn_commitmentfees").setValue(0.00);
        formContext.getAttribute("ukn_lossclaims").setValue(0.00);
        formContext.getAttribute("ukn_interestfees").setValue(0.00);
        formContext.getAttribute("ukn_arrangementfees").setValue(0.00);
        formContext.getAttribute("ukn_otherleviedfees").setValue(0.00);
        formContext.getAttribute("ukn_nonutilisationfees").setValue(0.00);
        formContext.getAttribute("ukn_directtopl").setValue(0.00);

        formContext.ui.setFormNotification("Capital recallable adjustment will not get pushed to focal point", "WARNING", "CapitalRecallableAdjustment_FormNotification");
    }
    else
    {
        hideTabs(executionContext);
        formContext.ui.clearFormNotification("CapitalRecallableAdjustment_FormNotification");
    }
}

function switchBPF(executionContext) 
{
    var activeProcessId = Xrm.Page.data.process.getActiveProcess().getId();

    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();

    if (approvalType == 968200003) 
    {
        Xrm.Utility.showProgressIndicator("Please wait a moment...");
        SetFieldsNotRequired(executionContext);
        formContext.data.process.setActiveProcess("f9028bf6-7948-42a5-9943-fd342261a476", callbackFunction);
    }
    else if(activeProcessId != "5ee7c9fc-079f-4939-b4ec-03f2bd0a5364")
    {
        Xrm.Utility.showProgressIndicator("Please wait a moment...");        
        SetFieldsNotRequired(executionContext);
        formContext.data.process.setActiveProcess("5ee7c9fc-079f-4939-b4ec-03f2bd0a5364", callbackFunction);
    }
    globalContext = executionContext;
}
   
function callbackFunction(result) 
{
    if (result == "success") 
    {
        Xrm.Utility.closeProgressIndicator();
        SetFieldsRequired();
    }

    else 
    {   
        Xrm.Utility.closeProgressIndicator();
    }
}

function SetFieldsRequired() {
    if(globalContext == null || globalContext == "undefined")
        return;

    var formContext = globalContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var drawdownType = formContext.getAttribute("ukn_drawdownapprovaltype").getValue();
    var distributionType = formContext.getAttribute("ukn_distributionapprovaltype").getValue();
    //Drawdown Only
    if (approvalType == 968200000 && drawdownType == null) {
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("required");
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("required")
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("required");
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("required");
    }
    //Net Drawdown
    else if (approvalType == 968200000 && drawdownType == 968200001) {
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("required");
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("required");
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("required");
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("required");
    }
    //Distribution Only
    else if (approvalType == 968200001 && distributionType == null) {
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("required");
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("required");
    }
    //Net Distribution
    else if (approvalType == 968200001 && distributionType == 968200001) {
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("required");
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("required");
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("required");
    }
    //Lender Settlements
    else if (approvalType == 968200002) {
        formContext.getAttribute("ukn_totalvalueofclaim").setRequiredLevel("required");
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("required");
        
    }
    //Adjustment
    else if (approvalType == 968200003) 
    {
        var iscapitalrecallableadjustment = formContext.getAttribute("ukn_iscapitalrecallableadjustment").getValue();
        formContext.getAttribute("ukn_facility").setRequiredLevel("required");
        formContext.getAttribute("ukn_adjustmentdate").setRequiredLevel("required");
        
        if(iscapitalrecallableadjustment == true)
        {
            formContext.getAttribute("ukn_capitalrecallable").setRequiredLevel("required");
        }
        else
        {
            formContext.getAttribute("ukn_capitalrecallable").setRequiredLevel("none");
        }
    }
}

function SetFieldsNotRequired(executionContext) {
    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var drawdownType = formContext.getAttribute("ukn_drawdownapprovaltype").getValue();
    var distributionType = formContext.getAttribute("ukn_distributionapprovaltype").getValue();
    //Drawdown
    if (approvalType == 968200000) 
    {
        formContext.getAttribute("ukn_grossvalueofdrawdown").setRequiredLevel("none");
        formContext.getAttribute("ukn_netvalueofdrawdown").setRequiredLevel("none")
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("none");
        formContext.getAttribute("ukn_noticereceiveddate").setRequiredLevel("none");
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("none");
        formContext.getAttribute("ukn_drawdownapprovaltype").setRequiredLevel("none");
        formContext.getAttribute("ukn_facility").setRequiredLevel("none");

    }
    //Distribution
    else if (approvalType == 968200001) 
    {
        formContext.getAttribute("ukn_grossvalueofdistributableproceeds").setRequiredLevel("none");
        formContext.getAttribute("ukn_totalamountofdistributionsnotice").setRequiredLevel("none");
        formContext.getAttribute("ukn_grossamountrequested").setRequiredLevel("none");
        formContext.getAttribute("ukn_distributionapprovaltype").setRequiredLevel("none");
        formContext.getAttribute("ukn_facility").setRequiredLevel("none");
        formContext.getAttribute("ukn_noticereceiveddate").setRequiredLevel("none");
    }
    //Lender Settlements
    else if (approvalType == 968200002) 
    {
        formContext.getAttribute("ukn_totalvalueofclaim").setRequiredLevel("none");
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("none");
        formContext.getAttribute("ukn_facility").setRequiredLevel("none");
        formContext.getAttribute("ukn_noticereceiveddate").setRequiredLevel("none");
        formContext.getAttribute("ukn_paymentvaluedate").setRequiredLevel("none");
    }
    else if (approvalType == 968200003) 
    {
        formContext.getAttribute("ukn_facility").setRequiredLevel("none");
        formContext.getAttribute("ukn_adjustmentdate").setRequiredLevel("none");
    }    
}

function activeStage(executionContext) {
    var formContext = executionContext.getFormContext();
    var activeStage = formContext.data.process.getActiveStage();
    var stageName = activeStage.getName();
    if (stageName == "Transaction Header") {
        getSectionToEnable(formContext.ui.tabs.get("transaction_header"));
        getSectionToDisable(formContext.ui.tabs.get("operations"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_review"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToDisable(formContext.ui.tabs.get("finance_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_payments"));
    } else if (stageName == "Operations") {
        getSectionToDisable(formContext.ui.tabs.get("transaction_header"));
        getSectionToEnable(formContext.ui.tabs.get("operations"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_review"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToDisable(formContext.ui.tabs.get("finance_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_payments"));
    } else if (stageName == "Product Team Review") {
        getSectionToDisable(formContext.ui.tabs.get("transaction_header"));
        getSectionToDisable(formContext.ui.tabs.get("operations"));
        getSectionToEnable(formContext.ui.tabs.get("product_team_review"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToDisable(formContext.ui.tabs.get("finance_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_payments"));
    } else if (stageName == "Product Team Approval") {
        getSectionToDisable(formContext.ui.tabs.get("transaction_header"));
        getSectionToDisable(formContext.ui.tabs.get("operations"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_review"));
        getSectionToEnable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToDisable(formContext.ui.tabs.get("finance_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_payments"));
    } else if (stageName == "Finance Ops Checks") {
        getSectionToDisable(formContext.ui.tabs.get("transaction_header"));
        getSectionToDisable(formContext.ui.tabs.get("operations"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_review"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToEnable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToDisable(formContext.ui.tabs.get("finance_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_payments"));
    } else if (stageName == "Finance Approval") {
        getSectionToDisable(formContext.ui.tabs.get("transaction_header"));
        getSectionToDisable(formContext.ui.tabs.get("operations"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_review"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToEnable(formContext.ui.tabs.get("finance_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_payments"));
    } else if (stageName == "Finance 2ND Approval") {
        getSectionToDisable(formContext.ui.tabs.get("transaction_header"));
        getSectionToDisable(formContext.ui.tabs.get("operations"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_review"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToDisable(formContext.ui.tabs.get("finance_approval"));
        getSectionToEnable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_payments"));
    } else if (stageName == "Finance Payments") {
        getSectionToDisable(formContext.ui.tabs.get("transaction_header"));
        getSectionToDisable(formContext.ui.tabs.get("operations"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_review"));
        getSectionToDisable(formContext.ui.tabs.get("product_team_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_ops_checks"));
        getSectionToDisable(formContext.ui.tabs.get("finance_approval"));
        getSectionToDisable(formContext.ui.tabs.get("finance_2nd_approval"));
        getSectionToEnable(formContext.ui.tabs.get("finance_payments"));
    }
    alwaysLocked(executionContext);
}

function getSectionToDisable(tab) {
    var tabSections = tab.sections.get();
    for (var i in tabSections) {

        var section = tabSections[i]
        sectionReadOnly(section);
    }
}

function getSectionToEnable(tab) {
    var tabSections = tab.sections.get();
    for (var i in tabSections) {

        var section = tabSections[i]
        sectionEditable(section);
    }
}

function sectionReadOnly(section) {
    var control = section.controls.get();
    var controlLength = control.length;

    for (var i = 0; i < controlLength; i++) {
        if (control[i].getControlType() != "subgrid") {
            control[i].setDisabled(true);
        }
    }
}

function sectionEditable(section) {
    var control = section.controls.get();
    var controlLength = control.length;
    for (var i = 0; i < controlLength; i++) {
        if (control[i].getControlType() != "subgrid") {
            control[i].setDisabled(false);
        }
    }
}

function alwaysLocked(executionContext) {
    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype");
    var drawdownType = formContext.getAttribute("ukn_drawdownapprovaltype");
    var distributionType = formContext.getAttribute("ukn_distributionapprovaltype"); 
formContext.getControl("transactioncurrencyid").setDisabled(true);
    formContext.getControl("ukn_dateapprovedops").setDisabled(true);
    formContext.getControl("ukn_datereviewedproductteam").setDisabled(true);
    formContext.getControl("ukn_dateapprovedprod").setDisabled(true);
    formContext.getControl("ukn_datecheckedfinanceops").setDisabled(true);
    formContext.getControl("ukn_dateapprovedfinanceapproval").setDisabled(true);
    formContext.getControl("ukn_dateapprovedfinance2ndapproval").setDisabled(true);
    formContext.getControl("ukn_datechecked").setDisabled(true);
    formContext.getControl("ukn_remainingcommitment").setDisabled(true);
    formContext.getControl("ukn_drawdownrequesttype").setDisabled(true);
    formContext.getControl("ukn_funddeliverypartner").setDisabled(true);
    formContext.getControl("ukn_programme").setDisabled(true);
    formContext.getControl("ukn_drawdownnoticedate").setDisabled(true);
    formContext.getControl("ukn_financeopscheckscompletedby").setDisabled(true);
    //CRMD-424 : always lock finance approval related fields. Not able to lock via BR, achieved using js because
    //another method written to enable all the fields in the section.
    formContext.getControl("ukn_approvedbyfinance2ndapproval").setDisabled(true);
    formContext.getControl("ukn_approvedbyfinanceapproval").setDisabled(true);
}

function setDisclaimerText(executionContext) {
    var type = "";
    var opsText = "";
    var prodReviewText = "";
    var prodText = "";
    var formContext = executionContext.getFormContext();

    //Get approval type
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();

    if (approvalType == 968200000) {
        type = "drawdown";
    } else if (approvalType == 968200001) {
        type = "distribution";
    } else if (approvalType == 968200002) {
        type = "lender settlement";
    }

    opsText = "I Approve this " + type + " and confirm the above checks are completed and compliant with the contractual agreement.";
    prodReviewText = "I Approve this " + type + " and confirm the above checks are completed and compliant with the contractual agreement.";

    if(formContext.getAttribute("ukn_operationsdecision").getValue() != null)
    {
        if(formContext.getAttribute("ukn_operationsdecision").getValue() == "968200000")
        {
            opsText = "I Approve this " + type + " and confirm the above checks are completed and compliant with the contractual agreement.";
        }
        else if(formContext.getAttribute("ukn_operationsdecision").getValue() == "968200001")
        {
            opsText = "I Reject this " + type + " and confirm the above checks are not completed and not compliant with the contractual agreement.";
        }
    }

    if(formContext.getAttribute("ukn_productteamreviewerdecision").getValue() != null)
    {
        if(formContext.getAttribute("ukn_productteamreviewerdecision").getValue() == "968200000")
        {
            prodReviewText = "I Approve this " + type + " and confirm the above checks are completed and compliant with the contractual agreement.";

        }
        else if(formContext.getAttribute("ukn_productteamreviewerdecision").getValue() == "968200001")
        {
            prodReviewText = "I Reject this " + type + " and confirm the above checks are not completed and not compliant with the contractual agreement.";
        }
    }
    if (approvalType != 968200002) 
    {
        prodText = "I Approve this " + type + " and confirm it’s compliant with the contractual agreement and that the " + type + " amount requested by the delivery partner is within my delegated authority limits.";

        if(formContext.getAttribute("ukn_productteamdecision").getValue() != null)
        {
            if(formContext.getAttribute("ukn_productteamdecision").getValue() == "968200000")
            {
                prodText = "I Approve this " + type + " and confirm it’s compliant with the contractual agreement and that the " + type + " amount requested by the delivery partner is within my delegated authority limits.";
            }
            else
            {
                prodText = "I Reject this " + type + " and confirm it’s not compliant with the contractual agreement and that the " + type + " amount requested by the delivery partner is not within my delegated authority limits.";
            }
        }
    } 
    else 
    {
        prodText = "I Approve this lender settlement payment and confirm that it agrees with the supporting documentation provided by PWC and finance and is within my delegated authority limit.";

        if(formContext.getAttribute("ukn_productteamdecision").getValue() != null)
        {
            if(formContext.getAttribute("ukn_productteamdecision").getValue() == "968200000")
            {
                prodText = "I Approve this lender settlement payment and confirm that it agrees with the supporting documentation provided by PWC and finance and is within my delegated authority limit.";
            }
            else
            {
                prodText = "I Reject this lender settlement payment and confirm that it does not agree with the supporting documentation provided by PWC and finance and is not within my delegated authority limit.";
            }
        }
    }
    
    var financeApprovalText = "Finance Approval holding text"
    var finance2ndApprovalText = "Finance 2nd Approval holding text"

    formContext.getAttribute("ukn_opsdisclaimertext").setValue(opsText);
    formContext.getAttribute("ukn_productteamreviewerapprovaltext").setValue(prodReviewText);
    formContext.getAttribute("ukn_proddisclaimertext").setValue(prodText);    
    formContext.getAttribute("ukn_financeapprovaldisclaimertext").setValue(financeApprovalText);
    formContext.getAttribute("ukn_finance2ndapprovaldisclaimertext").setValue(finance2ndApprovalText);
}

function onSave(executionContext) {
    var formContext = executionContext.getFormContext();
    var activeStage = formContext.data.process.getActiveStage();
    var name = activeStage.getName();
    var distType = formContext.getAttribute("ukn_distributionapprovaltype");
    var approvalStatus = formContext.getAttribute("ukn_approvalstatus").getValue();

    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var drawdownType = formContext.getAttribute("ukn_drawdownapprovaltype").getValue();
    
    if (approvalType == 968200000 && drawdownType == 968200001) 
    {    
        var netvalueofDrawdown = formContext.getAttribute("ukn_netvalueofdrawdown").getValue();
        
        if((netvalueofDrawdown == 0 || netvalueofDrawdown == 0.00) && approvalStatus == null)
        {

            var alertStrings = { confirmButtonLabel: "Ok", text: "Net value of Drawdown is 0. No payment will be required..", title: "Warning" };
            var alertOptions = { height: 120, width: 360 };
            Xrm.Navigation.openAlertDialog(alertStrings, alertOptions);
        }    
    }

    if (name == "Operations") {
        var reviewer = formContext.getAttribute("ukn_reviewedbyproductteam");
        if (reviewer != null) {
            var user = reviewer.getValue();
            if (user != null) {
                formContext.getAttribute("ukn_pt_reviewer").setValue(user);
            }
        }
    } else if (name == "Product Team Review") {
        var approver = formContext.getAttribute("ukn_approvedbyprod");
        if (approver != null) {
            var userApp = approver.getValue();
            if (userApp != null) {
                formContext.getAttribute("ukn_ptapprover").setValue(userApp);
            }
        }
    } else if (name == "Finance Ops Checks") {
        var approver = formContext.getAttribute("ukn_approvalrequiredbyfinance");
        if (approver != null) {
            var userApp = approver.getValue();
            if (userApp != null) {
                formContext.getAttribute("ukn_approvedbyfinanceapproval").setValue(userApp);
            }
        }
    } else if (name == "Finance Approval") {
        var approver = formContext.getAttribute("ukn_approvalrequiredbyfinance2ndapproval");
        if (approver != null) {
            var userApp = approver.getValue();
            if (userApp != null) {
                formContext.getAttribute("ukn_approvedbyfinance2ndapproval").setValue(userApp);
            }
        }
    }
}

function addCustomFilter(executionContext) {
    debugger;
    var formContext = executionContext.getFormContext();
    //var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();

    //Amount should be always net amount to be paid irrespective of approval type, confirmed by Diana and James.
    var amount = null;
    //get investment program
    var investmentProgram = formContext.getAttribute("ukn_programme");
    var operationTeam = 968200000;
    var reviewerTeam = 968200002;
    var AuthoriserTeam = 968200001;
    var financeTeam = 968200003;

    //get finance approver
    var financeApprover = formContext.getAttribute("ukn_approvedbyfinanceapproval");
    var appRequest = formContext.getAttribute("ukn_approvalrequesttype");

    if(appRequest.getText() == null)
    {
        return;
    }

    if(appRequest.getText() == "Distribution")
    {
        amount = formContext.getAttribute("ukn_netamounttobereceived");
    }
    else
    {
        amount = formContext.getAttribute("ukn_netamounttobepaid");
    }

    if (amount.getValue() != null && investmentProgram.getValue() != null) {

        var layout = "<grid name=\"resultset\" object=\"8\" jump=\"fullname\" select=\"1\" preview=\"1\" icon=\"1\">" +
            "<row name=\"result\" id=\"systemuserid\"><cell name=\"fullname\" width=\"150\" /></row></grid>";

        var viewIdOperations = formContext.getControl("ukn_approvedbyops").getDefaultView();
        var viewIdReviewers = formContext.getControl("ukn_reviewedbyproductteam").getDefaultView();
        var viewIdapprovers = formContext.getControl("ukn_approvedbyprod").getDefaultView();
        var viewIdFinanceApprovers = formContext.getControl("ukn_approvalrequiredbyfinance").getDefaultView();
        var viewIdFinance2ndApprovers = formContext.getControl("ukn_approvalrequiredbyfinance2ndapproval").getDefaultView();

        var entityName = "systemuser";
        var viewDisplayNameOp = "Active Operation Users";
        var viewDisplayNameRw = "Active Reviewer Users";
        var viewDisplayNameAp = "Active Approval Users";
        var viewDisplayNameFinAp = "Active Finance Approval Users";
        var viewDisplayNameFin2ndAp = "Active Finance 2nd Approval Users";

        var fetchxmlOperation = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + operationTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            //"<condition attribute='ukn_amount' operator='le' value='" + amount.getValue() + "' />" +
            "<filter type='or'>" +
            "<condition attribute='ukn_amount' operator='ge' value='" + amount.getValue() + "' />" +
            "<condition attribute='ukn_unlimited' operator='eq' value='1' />" +
            "</filter>" +
            "<condition attribute='ukn_investmentprogram' operator='eq' uiname='BPC' uitype='bbb_investmentprogramme' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";

        var fetchxmlReview = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + reviewerTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<filter type='or'>" +
            "<condition attribute='ukn_amount' operator='ge' value='" + amount.getValue() + "' />" +
            "<condition attribute='ukn_unlimited' operator='eq' value='1' />" +
            "</filter>" +
            "<condition attribute='ukn_investmentprogram' operator='eq' uiname='BPC' uitype='bbb_investmentprogramme' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";

        var fetchxmlApprover = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + AuthoriserTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<filter type='or'>" +
            "<condition attribute='ukn_amount' operator='ge' value='" + amount.getValue() + "' />" +
            "<condition attribute='ukn_unlimited' operator='eq' value='1' />" +
            "</filter>" +
            "<condition attribute='ukn_investmentprogram' operator='eq' uiname='BPC' uitype='bbb_investmentprogramme' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";

        var fetchxmlFinanceApprover = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + financeTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<filter type='or'>" +
            "<condition attribute='ukn_amount' operator='ge' value='" + amount.getValue() + "' />" +
            "<condition attribute='ukn_unlimited' operator='eq' value='1' />" +
            "</filter>" +
            "<condition attribute='ukn_investmentprogram' operator='eq' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";

        var fetchxmlFinance2ndApprover = filterFinance2Approver(formContext.getAttribute("ukn_approvalrequiredbyfinance").getValue(), financeTeam, investmentProgram);

        var distType = formContext.getAttribute("ukn_distributionapprovaltype");
        if (appRequest != null) {
            if (appRequest.getText() == "Drawdown") {
                formContext.getControl("ukn_approvedbyops").addCustomView(viewIdOperations, entityName, viewDisplayNameOp, fetchxmlOperation, layout, true);
                formContext.getControl("header_process_ukn_reviewedbyproductteam").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                if (formContext.getControl("header_process_ukn_reviewedbyproductteam_1") !== null) {
                    formContext.getControl("header_process_ukn_reviewedbyproductteam_1").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                }
                if (formContext.getControl("header_process_ukn_approvedbyprod") !== null) {
                    formContext.getControl("header_process_ukn_approvedbyprod").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("header_process_ukn_approvedbyprod_1") !== null) {
                    formContext.getControl("header_process_ukn_approvedbyprod_1").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("ukn_reviewedbyproductteam") !== null) {
                    formContext.getControl("ukn_reviewedbyproductteam").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                }
                if (formContext.getControl("ukn_pt_reviewer") !== null) {
                    formContext.getControl("ukn_pt_reviewer").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                }
                if (formContext.getControl("ukn_approvedbyprod") !== null) {
                    formContext.getControl("ukn_approvedbyprod").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("ukn_approvebybbfl") !== null) {
                    formContext.getControl("ukn_approvebybbfl").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("ukn_ptapprover") !== null) {
                    formContext.getControl("ukn_ptapprover").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("ukn_approvalrequiredbyfinance") !== null) {
                    formContext.getControl("ukn_approvalrequiredbyfinance").addCustomView(viewIdFinanceApprovers, entityName, viewDisplayNameFinAp, fetchxmlFinanceApprover, layout, true);
                }
                if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance") !== null) {
                    formContext.getControl("header_process_ukn_approvalrequiredbyfinance").addCustomView(viewIdFinanceApprovers, entityName, viewDisplayNameFinAp, fetchxmlFinanceApprover, layout, true);
                }
                if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance_1") !== null) {
                    formContext.getControl("header_process_ukn_approvalrequiredbyfinance_1").addCustomView(viewIdFinanceApprovers, entityName, viewDisplayNameFinAp, fetchxmlFinanceApprover, layout, true);
                }
                if (formContext.getControl("ukn_approvedbyfinanceapproval") !== null) {
                    formContext.getControl("ukn_approvedbyfinanceapproval").addCustomView(viewIdFinanceApprovers, entityName, viewDisplayNameFinAp, fetchxmlFinanceApprover, layout, true);
                }
                if (formContext.getControl("ukn_approvalrequiredbyfinance2ndapproval") !== null) {
                    formContext.getControl("ukn_approvalrequiredbyfinance2ndapproval").addCustomView(viewIdFinance2ndApprovers, entityName, viewDisplayNameFin2ndAp, fetchxmlFinance2ndApprover, layout, true);
                }
                if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval") !== null) {
                    formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").addCustomView(viewIdFinance2ndApprovers, entityName, viewDisplayNameFin2ndAp, fetchxmlFinance2ndApprover, layout, true);
                }
                if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval_2") !== null) {
                    formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval_2").addCustomView(viewIdFinance2ndApprovers, entityName, viewDisplayNameFin2ndAp, fetchxmlFinance2ndApprover, layout, true);
                }
                if (formContext.getControl("ukn_approvedbyfinance2ndapproval") !== null) {
                    formContext.getControl("ukn_approvedbyfinance2ndapproval").addCustomView(viewIdFinance2ndApprovers, entityName, viewDisplayNameFin2ndAp, fetchxmlFinance2ndApprover, layout, true);
                }
            } else if (appRequest.getText() == "Lender Settlement") {
                formContext.getControl("ukn_approvedbyops").addCustomView(viewIdOperations, entityName, viewDisplayNameOp, fetchxmlOperation, layout, true);
                formContext.getControl("header_process_ukn_reviewedbyproductteam_3").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                formContext.getControl("header_process_ukn_approvedbyprod_3").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                formContext.getControl("ukn_reviewedbyproductteam").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                formContext.getControl("ukn_pt_reviewer").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                formContext.getControl("ukn_approvedbyprod").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                formContext.getControl("ukn_approvebybbfl").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                formContext.getControl("ukn_ptapprover").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                formContext.getControl("ukn_approvalrequiredbyfinance").addCustomView(viewIdFinanceApprovers, entityName, viewDisplayNameFinAp, fetchxmlFinanceApprover, layout, true);
                formContext.getControl("header_process_ukn_approvalrequiredbyfinance_2").addCustomView(viewIdFinanceApprovers,
                    entityName, viewDisplayNameFinAp, fetchxmlFinanceApprover, layout, true);
                formContext.getControl("ukn_approvedbyfinanceapproval").addCustomView(viewIdFinanceApprovers, entityName, viewDisplayNameFinAp, fetchxmlFinanceApprover, layout, true);
                formContext.getControl("ukn_approvalrequiredbyfinance2ndapproval").addCustomView(viewIdFinance2ndApprovers, entityName, viewDisplayNameFin2ndAp, fetchxmlFinance2ndApprover, layout, true);
                formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval_4").addCustomView(viewIdFinance2ndApprovers, entityName, viewDisplayNameFin2ndAp, fetchxmlFinance2ndApprover, layout, true);
                formContext.getControl("ukn_approvedbyfinance2ndapproval").addCustomView(viewIdFinance2ndApprovers, entityName, viewDisplayNameFin2ndAp, fetchxmlFinance2ndApprover, layout, true);
            } else if (appRequest.getText() == "Distribution" && distType.getText() == "Net Distributions") {
                if (formContext.getControl("header_process_ukn_reviewedbyproductteam_2") !== null) {
                    formContext.getControl("header_process_ukn_reviewedbyproductteam_2").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                }
                if (formContext.getControl("header_process_ukn_approvedbyprod_2") !== null) {
                    formContext.getControl("header_process_ukn_approvedbyprod_2").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("ukn_reviewedbyproductteam") !== null) {
                    formContext.getControl("ukn_reviewedbyproductteam").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                }
                if (formContext.getControl("ukn_pt_reviewer") !== null) {
                    formContext.getControl("ukn_pt_reviewer").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
                }
                if (formContext.getControl("ukn_approvedbyprod") !== null) {
                    formContext.getControl("ukn_approvedbyprod").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("ukn_approvebybbfl") !== null) {
                    formContext.getControl("ukn_approvebybbfl").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
                if (formContext.getControl("ukn_ptapprover") !== null) {
                    formContext.getControl("ukn_ptapprover").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
                }
            }
        }
    }
}

function addCustomFilterForAdjustment(executionContext) {
    debugger;
    var formContext = executionContext.getFormContext();

    var investmentProgram = formContext.getAttribute("ukn_programme");
    var operationTeam = 968200000;
    var reviewerTeam = 968200002;
    var AuthoriserTeam = 968200001;

    var appRequest = formContext.getAttribute("ukn_approvalrequesttype");

    if (appRequest.getText() != null && appRequest.getText() == "Adjustment" && investmentProgram.getValue() != null) 
    {
        var layout = "<grid name=\"resultset\" object=\"8\" jump=\"fullname\" select=\"1\" preview=\"1\" icon=\"1\">" +
            "<row name=\"result\" id=\"systemuserid\"><cell name=\"fullname\" width=\"150\" /></row></grid>";

        var viewIdOperations = formContext.getControl("ukn_approvedbyops").getDefaultView();
        var viewIdReviewers = formContext.getControl("ukn_reviewedbyproductteam").getDefaultView();
        var viewIdapprovers = formContext.getControl("ukn_approvedbyprod").getDefaultView();

        var entityName = "systemuser";
        var viewDisplayNameOp = "Active Operation Users";
        var viewDisplayNameRw = "Active Reviewer Users";
        var viewDisplayNameAp = "Active Approval Users";

        var fetchxmlOperation = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + operationTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<filter type='or'>" +
            "<condition attribute='ukn_amount' operator='ge' value='0' />" +
            "<condition attribute='ukn_unlimited' operator='eq' value='1' />" +
            "</filter>" +
            "<condition attribute='ukn_investmentprogram' operator='eq' uiname='BPC' uitype='bbb_investmentprogramme' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";

        var fetchxmlReview = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + reviewerTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<filter type='or'>" +
            "<condition attribute='ukn_amount' operator='ge' value='0' />" +
            "<condition attribute='ukn_unlimited' operator='eq' value='1' />" +
            "</filter>" +
            "<condition attribute='ukn_investmentprogram' operator='eq' uiname='BPC' uitype='bbb_investmentprogramme' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";

        var fetchxmlApprover = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + AuthoriserTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<filter type='or'>" +
            "<condition attribute='ukn_amount' operator='ge' value='0' />" +
            "<condition attribute='ukn_unlimited' operator='eq' value='1' />" +
            "</filter>" +
            "<condition attribute='ukn_investmentprogram' operator='eq' uiname='BPC' uitype='bbb_investmentprogramme' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";
        
        if (formContext.getControl("header_process_ukn_reviewedbyproductteam") !== null) 
        {
            formContext.getControl("header_process_ukn_reviewedbyproductteam").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
        }
        if (formContext.getControl("header_process_ukn_approvedbyprod") !== null) 
        {
            formContext.getControl("header_process_ukn_approvedbyprod").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
        }
        if (formContext.getControl("ukn_reviewedbyproductteam") !== null) 
        {
            formContext.getControl("ukn_reviewedbyproductteam").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
        }
        if (formContext.getControl("ukn_pt_reviewer") !== null) 
        {
            formContext.getControl("ukn_pt_reviewer").addCustomView(viewIdReviewers, entityName, viewDisplayNameRw, fetchxmlReview, layout, true);
        }
        if (formContext.getControl("ukn_approvedbyprod") !== null) 
        {
            formContext.getControl("ukn_approvedbyprod").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
        }                
        if (formContext.getControl("ukn_ptapprover") !== null) 
        {
            formContext.getControl("ukn_ptapprover").addCustomView(viewIdapprovers, entityName, viewDisplayNameAp, fetchxmlApprover, layout, true);
        }
    }
}



//filter finance 2 approver based on change of finance 1 approver
function filterFinance2Approver(financeRequiredbyApproval1, financeTeam, investmentProgram) {
    if (financeRequiredbyApproval1 !== null) {
        var fetchxmlFinance2ndApprover = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + financeTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<condition attribute='ukn_user' operator='ne' value='" + financeRequiredbyApproval1[0].id + "' />" +
            "<condition attribute='ukn_investmentprogram' operator='eq' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";
    }
    else {
        var fetchxmlFinance2ndApprover = "<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'>" +
            "<entity name='systemuser'> " +
            "<attribute name='fullname' /> " +
            "<attribute name='systemuserid' />" +
            "<filter type='and'>" +
            "<condition attribute='isdisabled' operator='eq' value='0' />" +
            "</filter>" +
            "<link-entity name='ukn_userpermissionid' from='ukn_user' to='systemuserid' link-type='inner' alias='av'>" +
            "<filter type='and'>" +
            "<condition attribute='ukn_userteam' operator='eq' value= '" + financeTeam + "' />" +
            "<condition attribute='statecode' operator='eq' value='0' />" +
            "<condition attribute='ukn_investmentprogram' operator='eq' value='" + investmentProgram.getValue()[0].id + "' />" +
            "</filter>" +
            "</link-entity>" +
            "</entity></fetch>";
    }

    return fetchxmlFinance2ndApprover;
}

//Makes rejection reason required on Approval Check Answers - triggered within subgrid on form
function makeRejectionReasonMandatory(executionContext) {
    var rejected = false;
    executionContext.getFormContext().getData().getEntity().attributes.forEach(function (attr) {
        attr.controls.forEach(function (c) {
            if (c.getName() === "ukn_decision" && attr.getText() === "Fail") {
                rejected = true;
            }
            if (c.getName() === "ukn_rejectionreason" && rejected == true) {
                //c.setRequiredLevel("required");
                attr.setRequiredLevel("required");
            }

            if (c.getName() === "ukn_decision" && attr.getText() === "Pass") {
                rejected = false;
            }
            if (c.getName() === "ukn_rejectionreason" && rejected == false) {
                //c.setRequiredLevel("required");
                attr.setRequiredLevel("none");

            }
        })
    });
}

function lockBpfFields(executionContext) {

    if(activeBPFId == "f9028bf6-7948-42a5-9943-fd342261a476")
    {
        return;
    }

    var formContext = executionContext.getFormContext();
    var approvalType = formContext.getAttribute("ukn_approvalrequesttype").getValue();
    var drawdownType = formContext.getAttribute("ukn_drawdownapprovaltype").getValue();
    var distributionType = formContext.getAttribute("ukn_distributionapprovaltype").getValue();
    var activeStage = formContext.data.process.getActiveStage();
    var stageName = activeStage.getName();
    if (stageName == "Transaction Header") {
        formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(false);
        formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(false);
        formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(false);
        formContext.getControl("header_process_ukn_operationsdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(true);
        formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(true);
        formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(true);
        formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_breakdownverified").setDisabled(true);
    }
    if (stageName == "Operations") {
        if (formContext.getControl("header_process_ukn_approvalrequesttype") !== null) {
            formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_approvalrequesttype_1") !== null) {
            formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_drawdownapprovaltype") !== null) {
            formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_distributionapprovaltype") !== null) {
            formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_operationsdecision") !== null) {
            formContext.getControl("header_process_ukn_operationsdecision").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_operationsdecision_1") !== null) {
            formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_operationsdecision_2") !== null) {
            formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_operationsdecision_3") !== null) {
            formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_operationsdecision_4") !== null) {
            formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_reviewedbyproductteam") !== null) {
            formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_reviewedbyproductteam_1") !== null) {
            formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_reviewedbyproductteam_2") !== null) {
            formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_reviewedbyproductteam_3") !== null) {
            formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(false);
        }
        if (formContext.getControl("header_process_ukn_productteamreviewerdecision") !== null) {
            formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_productteamreviewerdecision_1") !== null) {
            formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_productteamreviewerdecision_2") !== null) {
            formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_productteamreviewerdecision_3") !== null) {
            formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_approvedbyprod") !== null) {
            formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_approvedbyprod_1") !== null) {
            formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_approvedbyprod_2") !== null) {
            formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_approvedbyprod_3") !== null) {
            formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance") !== null) {
            formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_actualsterlingamountpaid") !== null) {
            formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_financeapproverdecision") !== null) {
            formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval") !== null) {
            formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_finance2ndapproverdecision") !== null) {
            formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(true);
        }
        if (formContext.getControl("header_process_ukn_breakdownverified") !== null) {
            formContext.getControl("header_process_ukn_breakdownverified").setDisabled(true);
        }
    }
    if (stageName == "Product Team Review") {
        formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(false);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(false);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(false);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(false);
        formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(false);
        formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(false);
        formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(false);
        formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(false);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(true);
        formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(true);
        formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(true);
        formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_breakdownverified").setDisabled(true);
    }
    if (stageName == "Product Team Approval") {
        formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(true);
        formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(true);
        formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(true);
        formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_breakdownverified").setDisabled(true);
    }
    if (stageName == "Finance Ops Checks") {
        formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(false);
        formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(true);
        formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(false);
        formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_breakdownverified").setDisabled(false);
    }
    if (stageName == "Finance Approval") {
        //CRMD-288 : Commenting out below line. It didn't worked due to some other BR unlocking the field. To resolve
        //created new BR to lock the field.     
        //formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(false);                      
        formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(true);
        formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(true);
        formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(false);
        formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_breakdownverified").setDisabled(true);
    }
    if (stageName == "Finance 2ND Approval") {
        formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(true);
        formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(true);
        formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(true);
        formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(false);
        formContext.getControl("header_process_ukn_breakdownverified").setDisabled(true);
    }
    if (stageName == "Finance Payments") {
        formContext.getControl("header_process_ukn_approvalrequesttype").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequesttype_1").setDisabled(true);
        formContext.getControl("header_process_ukn_drawdownapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_distributionapprovaltype").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_operationsdecision_4").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_1").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_2").setDisabled(true);
        formContext.getControl("header_process_ukn_reviewedbyproductteam_3").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_1").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_2").setDisabled(true);
        formContext.getControl("header_process_ukn_productteamreviewerdecision_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_1").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_2").setDisabled(true);
        formContext.getControl("header_process_ukn_approvedbyprod_3").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance").setDisabled(true);
        formContext.getControl("header_process_ukn_actualsterlingamountpaid").setDisabled(false);
        formContext.getControl("header_process_ukn_financeapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_approvalrequiredbyfinance2ndapproval").setDisabled(true);
        formContext.getControl("header_process_ukn_finance2ndapproverdecision").setDisabled(true);
        formContext.getControl("header_process_ukn_breakdownverified").setDisabled(true);
    }
}

function refreshSubGrids(executionContext) {
    var formContext = executionContext.getFormContext();
    var opsgrid = formContext.getControl("approvalcheckquestionandanswers");
    var ptrgrid = formContext.getControl("approvalcheckquestionsanswers");

    opsgrid.refresh();
    ptrgrid.refresh();
}

function financeOpsCheck(executionContext) {
    var formContext = executionContext.getFormContext();

    var approvalRequesttype = formContext.getAttribute("ukn_approvalrequesttype");

    if (approvalRequesttype.getValue() == 968200001 || approvalRequesttype.getValue() == 968200003) {
        formContext.ui.tabs.get("finance_ops_checks").setVisible(false);
    } 
    else 
    {
        var netValueofDrawdown = formContext.getAttribute("ukn_netvalueofdrawdown").getValue();

        if(netValueofDrawdown == 0)
        {
            formContext.ui.tabs.get("finance_ops_checks").setVisible(false);
        }
        else
        {
            formContext.ui.tabs.get("finance_ops_checks").setVisible(true);
        }
    }
}
